{{ $entityParams := .}}
{{ $page := .Page }}
{{ $meta := page.Scratch.Get "clarismeta" }}
{{ $template := "claris/_functions/schema-org/_entities/article" }}
{{ $debug := and false (or .Debug ($page.Param "clarisdebug") ) }}
{{ $dbg := printf "%s[%s->%s]" (replaceRE `.*?((?:[^/]+/){,2})$` `$1` $page.RelPermalink) .Template (replaceRE `.*?([^/]+)$` `$1` $template) }}

{{ $entityParams := merge . (dict "Debug" $debug) }}

<!-- [Schema.org entity Article](https://schema.org/Article)
-->

{{ $articleEntity := dict }}

{{ with $meta.Single.Data }}
  {{ $articleData := (dict
      "@type" "Article"
      "@id" (printf "%s#%s" .CanonicalURL .ArticleID)
      "name" .Title
      "headline" .Title
      "description" (default $meta.Site.Data.Description .Description)
      "url" .CanonicalURL
      "articleSection" .ArticleSection
  ) }}
  {{ with .WordCount }}
    {{ $articleData = merge $articleData (dict "wordCount" . ) }}
  {{ end }}
  {{ $articleEntity = (dict
    "Entity" $articleData
    "Reference" (dict
      "@type" "Article"
      "@id" .CanonicalURL
    )
  ) }}
{{ else }}
  {{ errorf "%s Missing parameter $meta.Single.Data" $dbg }}
{{ end }}

{{ $schemaOrgArticle := (dict
  "Entities" (dict
    "Article" $articleEntity
  )
) }}

{{ if $debug }}
  {{ warnf "%s returning %v" $dbg
  (jsonify (dict "indent" "  ") $articleEntity) }}
{{ end }}

{{ return $schemaOrgArticle }}
