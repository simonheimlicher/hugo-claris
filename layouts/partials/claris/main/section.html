{{- $page := .Page }}
{{- $meta := page.Scratch.Get "clarismeta" }}
{{- $template := "partials/claris/main/section" }}
{{- $headingLevel := default 1 .HeadingLevel }}
{{- $itemType := "article" }}

{{- if eq .Kind "section" }}
  {{- $itemType = "section" }}
{{- end }}

{{- $debug := false }}
{{- /* {{- $debug = page.Scratch.Get "clarisdebug" }} */ -}}
{{/* {{- $debug = or $debug (not (not (findRE `/index` $page.RelPermalink) ) ) }} */}}

{{- with $page }}
  {{ partial "html-comment" (printf "[%s]: BEGIN" $template) }}

  {{- with .Content }}
    {{ partial "claris/_components/content" (dict "Page" $page "Meta" $meta "HeadingLevel" $headingLevel) }}
    {{- $headingLevel = add $headingLevel 1 }}
  {{- else }}
    {{ partial "claris/_components/title" (dict "Page" $page "Meta" $meta "HeadingLevel" $headingLevel) }}
  {{- end }}

  {{- $listPartialParams := (dict
    "Page" $page
    "ItemType" $itemType
    "HeadingLevel" $headingLevel) }}

  {{- with $page.Param "sectionsToShow" }}
    {{- $listPartialParams = merge $listPartialParams (dict
      "ListParams" (dict
        "SectionsToShow" .
      )
    ) }}
  {{- end }}

  {{- if $debug }}
    {{- warnf "%s[%s]: Calling 'claris/_components/list' with listPartialParams=%v" $page $template $listPartialParams }}
  {{- end }}
  {{ partial "claris/_components/list" $listPartialParams }}
{{- end }}
{{ partial "html-comment" (printf "[%s]:   END" $template) }}
